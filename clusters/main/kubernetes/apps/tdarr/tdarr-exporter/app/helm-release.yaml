apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: tdarr-exporter
    namespace: tdarr
spec:
    interval: 15m
    chart:
        spec:
            chart: app-template
            version: 14.5.2
            sourceRef:
                kind: HelmRepository
                name: truecharts
                namespace: flux-system
    releaseName: tdarr-exporter
    values:
        image:
            repository: homeylab/tdarr-exporter
            tag: 1.4.2
        service:
          metrics:
            enabled: true
            type: ClusterIP
            ports:
              metrics:
                enabled: true
                port: 9090
                targetPort: 9090
        workload:
            main:
                podSpec:
                    containers:
                        main:
                            env:
                                TDARR_URL: tdarr-comm.tdarr.svc.cluster.local
                                #TDARR_API_KEY:
        metrics:
          main:
            enabled: true
            type: "servicemonitor"
            endpoints:
              - port: metrics
                path: /metrics
            targetSelector: metrics
            prometheusRule:
              enabled: false